define("coupon-rain/index/index",function(require,exports,module){function init(){$("#J-container").on("touchstart",function(t){t.preventDefault()}),$("#J-start").on("touchstart",start)}function start(){startReq(function(){timerDown(),$("#J-container").addClass("playing"),startGetList(function(){startLeft(),startRight()})})}function startLeft(){var t=genItem();isOver||(t&&$list1.append(t),setTimeout(function(){startLeft()},duration[random(0,duration.length)]))}function startRight(){var t=genItem();isOver||(t&&$list2.append(t),setTimeout(function(){startRight()},duration[random(0,duration.length)]))}function timerDown(){var t,n=19,i=$("#J-timer-down");i.html("还剩<b>"+n+"</b>秒"),t=setInterval(function(){n--,i.html("还剩<b>"+n+"</b>秒"),0>=n&&(isOver=!0,clearInterval(t),(new Ajax).send({url:"/Activity/CouponRain/getCatchedCouponCount"},function(t){couponAmount=t.count,alertMsg()}))},1e3)}function alertMsg(data){data||(data={title:"手气不错哦",msg:"共抢到"+couponAmount+"张优惠券",type:"ok"},0==couponAmount&&(data={title:"时运不济啊",msg:"共抢到0张优惠券",type:"warning"})),Alert.show(function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="coupon-rain-panel">\r\n	<h3>'+(null==(__t=title)?"":__t)+'</h3>\r\n	<section>\r\n		<p class="msg">'+(null==(__t=msg)?"":__t)+'</p>\r\n		<div class="img-wrap icon-'+(null==(__t=type)?"":__t)+'"></div>\r\n		<div class="btn-wrap">\r\n			<a href="/Activity/CouponRain/showCatchedCouponList" class="btnl btnl-see">领取优惠券</a>\r\n			<a id="J-coupon-invite" class="btnl btnl-invite">邀请好友参与</a>\r\n		</div>\r\n	</section>\r\n</div>';return __p}(data),!1,"coupon-rain-alert"),new Guide("#J-coupon-invite","coupon-guide","邀请好友来一起抢吧～<br/><i>怎么邀请？你懂得！</i>")}function genItem(){var t,n=couponList[curIndex];return n?(t=$('<div type="'+n.type+'" code="'+n.code+'" class="item '+itemStyle[random(0,itemStyle.length)]+" "+speed[random(0,speed.length)]+'"></div>'),curIndex++,t.on("touchstart",function(){var n=t.attr("type"),i=t.attr("code");t.addClass(1==n?"award":"bomb"),setTimeout(function(){t.remove()},500),getAward(i)}).on(getAniEndName().aniEvtName,function(){t.remove()}),t):!1}function getAward(t){(new Ajax).send({url:"/Activity/CouponRain/catchOne",data:{code:t,openid:openid}},function(){})}function startReq(t){(new Ajax).send({url:"/Activity/CouponRain/start",data:{openid:openid}},function(n){return 1==n.joined?void alertMsg({title:"您已经抢过啦~",msg:"您已经抢完了，下次再抢哦~",type:"warning"}):void(t&&t())})}function startGetList(t){getCouponList(t),isOver||setTimeout(function(){startGetList()},5e3)}function getCouponList(t){(new Ajax).send({url:"/Activity/CouponRain/getCouponList",data:{c:20,openid:openid}},function(n){couponList=couponList.concat(n.list),t&&t()})}function random(t,n){return t+Math.floor(Math.random()*n)}function getAniEndName(){function t(t){for(var i in t)if(void 0!==n.style[i])return t[i]}var n=document.createElement("trans"),i={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",transition:"transitionend"},e={WebkitTransition:"webkitAnimationEnd",MozTransition:"animationend",OTransition:"oAnimationEnd",transition:"animationend"};return{transEvtName:t(i),aniEvtName:t(e)}}var $=require("zepto"),Ajax=require("common/ajax/index"),Alert=require("common/alert/alert"),Guide=require("common/guide/guide"),itemStyle=["item1","item2","item3","item4","item5"],speed=["","fast","faster"],duration=[500,1e3,1500],couponList=[],curIndex=0,isOver=!1,couponAmount=0,openid=$("#J-openid").val(),$list1=$("#J-list-1"),$list2=$("#J-list-2");init()});