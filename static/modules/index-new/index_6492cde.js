define("index-new/index",function(require,exports,module){function init(){sessionStorage.clear(),new Swiper({container:"banner",pager:"bannerPager"}),initTimer(),lazyLoadImg(),initImgLoader(),initMiao(),initNy(),Nav.initCart(),$(".J-add-cart").on("click",addCart),window.addCart=addCart}function lazyLoadImg(){$("[data-original]").lazyload({placeholderClass:"placeholder",effect:"fadeIn",threshold:1500})}function initNy(){$("#J-ny-nav>span").on("click",selNy),$("#J-ny-list").on("click",".ready-btn",remindNy),initNyTimer()}function selNy(){var $cur=$(this),tmpl=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="",$.each(list,function(i,n){__p+='\r\n<li act-id="'+(null==(__t=n.id)?"":__t)+'">\r\n	<a href="/Mall/Goods/detail?g='+(null==(__t=n.goodsInfo.product_id)?"":__t)+"&spe=1&act_id="+(null==(__t=n.id)?"":__t)+'">\r\n		<div class="img-wrap" style="background-image:url('+(null==(__t=n.image_url)?"":__t)+')">\r\n			',+n.goodsInfo.product_number<=0&&(__p+='\r\n			<div class="empty"></div>\r\n			'),__p+="\r\n			",!activityAlreadyStart&&n.remainTime&&(__p+='\r\n			<div class="ready-tip">\r\n				<p>距离开抢</p>\r\n				<p class="J-miao-timer" timer="'+(null==(__t=n.remainTime)?"":__t)+'"></p>\r\n				',__p+=1==n.subscribe?'\r\n				<button class="ready-btn active"><i class="icon-ling"></i><label>已订阅</label></button>\r\n				':'\r\n				<button class="ready-btn"><i class="icon-ling"></i><label>开抢提醒</label></button>\r\n				',__p+="\r\n			</div>\r\n			"),__p+='\r\n		</div>\r\n		<div class="banner-info clearfix">\r\n			',n.goodsInfo.discount&&(__p+='\r\n			<span class="qi">'+(null==(__t=n.goodsInfo.discount)?"":__t)+"折</span>\r\n			"),__p+='\r\n			<span class="banner-title">'+(null==(__t=n.title)?"":__t)+"</span>\r\n			",activityAlreadyStart&&(__p+='\r\n			<span class="banner-timer right" timer="21100">剩'+(null==(__t=n.remainTime)?"":__t)+"</span>\r\n			"),__p+="\r\n		</div>\r\n	</a>\r\n</li>\r\n"}),__p+="";return __p};(new Ajax).send({url:"/Mall/Activity/newYearSpeActivity",data:{type:$cur.attr("type")}},function(i){$cur.siblings(".active").removeClass("active"),$cur.addClass("active"),$("#J-ny-list").html(tmpl(i)),initNyTimer()})}function initNyTimer(){$("#J-ny-list .J-miao-timer").each(function(i,n){new Timer(n,"time").start().end(function(){})})}function remindNy(evt){evt.preventDefault();var $cur=$(this),id=$cur.parents("li").attr("act-id");(new Ajax).send({url:"/Mall/Activity/subscribeSpe",data:{id:id}},function(result){result.subscribed?$cur.addClass("active").find("label").text("已订阅"):Alert.show(function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="qrcode-panel">\r\n	<h3>关注公众号获得秒杀提醒</h3>\r\n	<div class="img-erwei">\r\n		<img src="http://cdn.taojinzi.com/static/images/erwei_51bd0ae.png" />\r\n		<!-- <div class="logo"><img src="/static/images/logo.png" /></div> -->\r\n	</div>\r\n	<p class="tip">长按二维码，扫描关注</p>\r\n</div>';return __p}(),!0,"alert-qrcode-alert")})}function initMiao(){$("#J-miao-nav").on("click","span",selMiao),$("#J-miao-list").on("click",".ready-btn",remind),initMiaoTimer()}function selMiao(){var $cur=$(this),tmpl=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="",$.each(list,function(i,n){__p+='\r\n<div class="temai-item dib">\r\n	<a href="/mall/Goods/detail?goodsId='+(null==(__t=n.goods_id)?"":__t)+'">\r\n		<div class="img-wrap" style="background-image: url('+(null==(__t=n.image_url)?"":__t)+')">\r\n			',1==n.soldout?__p+='\r\n			<div class="empty"></div>\r\n			':n.leftTime>0&&(__p+='\r\n			<div class="ready-tip">\r\n				<p>距离开抢</p>\r\n				<p class="J-miao-timer" timer="'+(null==(__t=n.leftTime)?"":__t)+'"></p>\r\n			</div>\r\n			'),__p+='\r\n		</div>\r\n		<div class="item-info">\r\n			<div class="item-title">'+(null==(__t=n.name)?"":__t)+'</div>\r\n			<div class="item-price">\r\n				<span class="price">&yen; '+(null==(__t=n.sale_price)?"":__t)+'</span>\r\n				<a class="btn-sm" ',1==n.start&&(__p+=' onclick="addCart(event)" '),__p+=' goods-id="'+(null==(__t=n.goods_id)?"":__t)+'"></a>\r\n			</div>\r\n		</div>\r\n	</a>\r\n</div>\r\n'}),__p+="";return __p};(new Ajax).send({url:$("#J-ajaxurl-miaoList").val(),data:{hour:$cur.text().split(":")[0]}},function(i){$cur.siblings(".active").removeClass("active"),$cur.addClass("active"),$("#J-miao-list").html(tmpl(i)),initMiaoTimer()})}function initMiaoTimer(){$("#J-miao-list .J-miao-timer").each(function(i,n){new Timer(n,"time").start().end(function(){})})}function remind(evt){evt.preventDefault();var $cur=$(this),id=$cur.parents("li").attr("act-id");(new Ajax).send({url:"/Mall/Activity/subscribeMiaoSha",data:{id:id}},function(result){result.subscribed?$cur.addClass("active").find("label").text("已订阅"):Alert.show(function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="qrcode-panel">\r\n	<h3>关注公众号获得秒杀提醒</h3>\r\n	<div class="img-erwei">\r\n		<img src="http://cdn.taojinzi.com/static/images/erwei_51bd0ae.png" />\r\n		<!-- <div class="logo"><img src="/static/images/logo.png" /></div> -->\r\n	</div>\r\n	<p class="tip">长按二维码，扫描关注</p>\r\n</div>';return __p}(),!0,"alert-qrcode-alert")})}function initTimer(){Util.phpdataReady(function(i){0==i.subscribe&&$(".atten-panel").css("display","block"),new Timer("#J-cut-timer",function(i){var n=parseInt(i/3600,10),t=parseInt((i-3600*n)/60),r=i-3600*n-60*t;return"<span><b>"+Timer.addZero(n)+"</b></span><i>:</i><span><b>"+Timer.addZero(t)+"</b></span><i>:</i><span><b>"+Timer.addZero(r)+"</b></span>"}).start(),$(".J-timer").each(function(i,n){new Timer(n,"time").start().end(function(){})})})}function addCart(i){i.preventDefault(),i.stopPropagation();var n=$(i.target),t=n.attr("goods-id");(new Ajax).send({url:$("#J-ajaxurl-addCart").val(),type:"post",data:{goodsId:t}},function(){new CartAni(n.parent().parent().parent().find(".img-wrap"),$(".gift")).fly(function(){Nav.initCart()})})}function initImgLoader(){window.onload=function(){function i(i,n){function t(){$(n).css("background-image","url("+i+")")}var r=new Image;return r.src=i,r.complete?void t():void(r.onload=function(){t()})}var n=$("[tjz-bgimg]");n.each(function(n,t){var r=$(t),a=r.attr("tjz-bgimg");a&&i(a,t)})}}var $=require("zepto");require("extend/lazyload"),require("common/gold/index");var Swiper=require("common/swiper/index"),Timer=require("common/timer/timer"),Ajax=require("common/ajax/index"),Util=require("common/util/index"),Alert=require("common/alert/alert"),CartAni=require("common/cart-ani/index"),Nav=require("common/nav/index");require("search-panel/index"),require("common/gotop/index"),init()});