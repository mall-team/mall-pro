define("chat/chat/index",function(t){function e(){s(),r()}function s(){c("#J-send").on("click",n)}function n(){var t=c("#J-msg").val();t&&(new l).send({type:"post",url:"/User/Customer/singleMsg",data:JSON.stringify({touser:o,msgtype:"text",token:g,text:{content:t}})},function(){c("#J-msg").val(""),a()},function(t){i(t.msg,"error")})}function r(){a(),setTimeout(function(){r()},3e3)}function a(){var t="/User/Customer/pullMsg";u&&(t="/User/Customer/recentMsg",u=!1),(new l).send({type:"get",url:t,data:{uid:o,token:g},selfErrorBack:!0},function(t){i(t)},function(t){t&&t.msg&&i(t.msg,"error")})}function i(t,e){var s,n,r="";switch(e=e||"msg"){case"msg":s=t.uid,n=t.list,c.each(n,function(t,e){r+="notice"==e.msgtype?'<p class="error-msg"><span>'+e.notice.content+"</span></p>":'<div class="chart-item '+(e.uid==s?"myself":"")+'">								<div class="chart-inner clearfix">									<div class="img-wrap" style="background-image: url('+e.headimgurl+')"></div>									<div class="info-wrap">										<p class="nick-wrap"><span class="date">'+new Date(e.time).format("MM-dd hh:mm")+'</span></p>										<div class="chart-content">'+e.text.content+"</div>									</div>								</div>							</div>"});break;case"error":r='<p class="error-msg"><span>'+t+"</span></p>"}c("#J-chart-list").append(c(r)),window.scroll(0,1e5)}var o,c=t("zepto"),l=t("common/ajax/index"),g=c("#J-token").val(),u=!0;try{o=location.search.match(/touser=([^&]+)/)[1]}catch(p){}Date.prototype.format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var s in e)new RegExp("("+s+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[s]:("00"+e[s]).substr((""+e[s]).length)));return t},e()});