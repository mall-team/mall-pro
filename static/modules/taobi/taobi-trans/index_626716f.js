define("taobi/taobi-trans/index",function(require,exports,module){function init(){addEvent()}function addEvent(){$("#J-custom-phone").on("input",checkClient),$("#J-amount").on("input",validateMoney),$("#J-client-btn").on("click",showClientList),$("#J-taobi-submit").on("click",submit)}function checkClient(){var e=$(this).val();return/^1[3-8]\d{9}$/.test(e)?void(new Ajax).send({url:"/User/Center/verifyMyRecommCustomer",data:{phone:$("#J-custom-phone").val()}},function(e){1==e.state?(curUser=e.customer,$("#J-nick").removeClass("nochecked").text(curUser.nickname||"该客户验证通过")):(curUser=null,$("#J-nick").addClass("nochecked").text("*不在我的客户内")),checkIsSubmit()},function(){curUser=null,$("#J-nick").addClass("nochecked").text("*不在我的客户内")}):(curUser=null,void $("#J-nick").text(""))}function showClientList(){(new Ajax).send({url:"/User/Center/getMyCustomerList"},function(result){var $container=$(function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="",list&&list.length>0?(__p+='\r\n<ul class="pop-client-list" style="max-height: '+(null==(__t=maxHei)?"":__t)+'px;overflow-y:auto;">\r\n	',$.each(list,function(e,n){__p+="\r\n	<li userinfo='"+(null==(__t=JSON.stringify(n))?"":__t)+'\'>\r\n		<div class="info">\r\n			<div class="img-wrap" style="background-image:url('+(null==(__t=n.head_sculpture)?"":__t)+')"></div>\r\n			<div class="info-inner">\r\n				<p class="nick">'+(null==(__t=n.nickname)?"":__t)+'</p>\r\n				<p class="phone">'+(null==(__t=n.cellphone)?"":__t)+'</p>\r\n			</div>\r\n		</div>\r\n		<div class="radio '+(null==(__t=curUser&&curUser.id==n.id?"selected":"")?"":__t)+'">\r\n			<i class="icon-radio"></i>\r\n		</div>\r\n	</li>\r\n	'}),__p+="\r\n</ul>\r\n"):__p+='\r\n<div class="pop-client-list empty">您暂时还没有客户哦~~</div>\r\n',__p+="";return __p}({list:result.list,curUser:curUser,maxHei:.7*$(window).height()}));Pop.show({title:"我的客户",content:$container}),$container.find("li").on("click",selClient),checkIsSubmit()})}function selClient(){var e=$(this);curUser=JSON.parse(e.attr("userinfo")),e.parent().find(".selected").removeClass("selected"),e.find(".radio").addClass("selected"),Pop.hide(),$("#J-custom-phone").val(curUser.cellphone),$("#J-nick").removeClass("nochecked").text(curUser.nickname)}function checkIsSubmit(){var e=curUser&&/^\d+$/.test($("#J-amount").val().trim());return $("#J-taobi-submit")[(e?"remove":"add")+"Class"]("disabled"),e}function validateMoney(){var e=$(this),n=e.val(),t=n.match(/\d+/);t?(n=+t[0],e.val(0>=n?"":n)):e.val(""),checkIsSubmit()}function submit(e){e.preventDefault();var n=$(this),t=$("#"+n.attr("form"));Confirm.show({msg:"您确定给"+curUser.nickname+"转"+$("#J-amount").val()+"个淘币吗？",yesBack:function(){(new Ajax).send({url:t.attr("action"),type:t.attr("method"),data:t.serialize()},function(){})}})}var $=require("zepto"),Ajax=require("common/ajax/index"),Pop=require("common/pop/index"),Confirm=require("common/confirm/index"),curUser=null;init()});