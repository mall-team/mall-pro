define("langsha-goods/index",function(require,exports,module){function initPage(){Panel.init(),addEvent(),new PageLoader({container:".comment-list",seeMore:".see-more",getHtml:function(pageNum,back){(new Ajax).send({url:"/index.php/goodsAction/moreComment",data:{g:getParam("g"),page:pageNum}},function(result){back&&back(function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="",_.each(list,function(e){__p+='\r\n<div class="comment">\r\n	<div class="comment-t clearfix">\r\n		<label>'+(null==(__t=e.user_name)?"":__t)+'</label>\r\n		<label class="right">'+(null==(__t=e.gmt_createtime)?"":__t)+'</label>\r\n	</div>\r\n	<div class="comment-des">'+(null==(__t=e.content)?"":__t)+"</div>\r\n</div>\r\n"}),__p+="";return __p}({list:result.data}),result.total_num)})}}).loadEnd(function(){$(".see-more").remove()})}function addEvent(){$("#J-btn-cart").on(EVENT_TAP,function(e){Panel.show("cart"),e.preventDefault()}),$("#J-btn-buy").on(EVENT_TAP,function(e){Panel.show("buy"),e.preventDefault()})}function getParam(e){var n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),t=location.search,a=t.substr(1).match(n);return t&&a?a[2]:""}function addCar(){if($("#spe_id").val()>0&&0==$("#spe_already_start").val())return!1;var e=$("#gid").val(),n=search_sku_key(),t=parseInt($("#J-cm-amount").find(".amount-val").text(),10);if(!n)return void Bubble.show("请选择商品属性");if(0==parseInt(n.sku_num)||parseInt(n.sku_num)<t||"empty"==n.sku_id)return void Bubble.show("已经卖光了，下次早点哦!");var a=Conf.host+"/index.php/CartAction/addCart",i={goods_id:e,sku_id:n.sku_id,goods_number:t,type:"add_cart"};(new Ajax).send({url:a,data:i,selfBack:!0},function(e){1==e.code?CartNum.add(t):5==e.code?(Bubble.show(e.msg),setTimeout(function(){window.location.href=e.url},2e3)):Bubble.show(e.msg)})}function quickBuy(){if($("#spe_id").val()>0&&0==$("#spe_already_start").val())return!1;var e=$("#gid").val(),n=search_sku_key(),t=parseInt($("#J-cm-amount").find(".amount-val").text(),10);if(!n)return void Bubble.show("请选择商品属性");if(0==parseInt(n.sku_num)||parseInt(n.sku_num)<t||"empty"==n.sku_id)return void Bubble.show("已经卖光了，下次早点哦!");var a=Conf.host+"/index.php/CartAction/temp_car",i={goods_id:e,goods_number:t,sku_id:n.sku_id};(new Ajax).send({url:a,data:i,selfBack:!0},function(e){1==e.code?window.location.href=e.url:Bubble.show(e.msg)})}function search_sku_key(){var sku_key=[],checked="",exit=!1,$dts=$("#J-cm").find("dt"),$dds=$("#J-cm").find("dd");$dts.each(function(e,n){var t=$(n),a=$($dds[e]);sku_key.push(t.text()+":"+a.find(".sel").text())});for(var sku_json=$("#goods_sku_json").val(),sku_o=eval("("+sku_json+")"),res={sku_id:"empty"},i=0;i<sku_o.length;i++)if(sku_key.join(",")==sku_o[i].sku_value){res=sku_o[i];break}return res}var EVENT_TAP="click",$=require("zepto"),_=require("underscore"),Conf=require("common/config/index"),PageLoader=require("common/page-loader/index"),Ajax=require("common/ajax/index"),Bubble=require("common/bubble/bubble"),Guide=require("common/guide/guide"),Amount=require("common/amount/index"),amount=new Amount,Swiper=require("common/swiper/index");new Swiper({container:"banner",pager:"bannerPager"}),new Guide("#J-share");var Panel={type:"",init:function(){var e=this,n=$("#J-panel-cm"),t=n.find(".close"),a=n.find(".mask"),i=n.find(".J-ok");t.on(EVENT_TAP,function(n){e.hidden(),n.preventDefault()}),a.on(EVENT_TAP,function(n){e.hidden(),n.preventDefault()}),i.on(EVENT_TAP,function(n){e.hidden(),"cart"==e.type?addCar():quickBuy(),n.preventDefault()}),e._initSel()},_initSel:function(){var e=this;e._resetSku(),amount.init(),$("#J-cm").delegate("label",EVENT_TAP,function(n){var t=$(n.target);t.siblings("label").removeClass("sel"),t.addClass("sel"),t.siblings("input").val(t.attr("value")),e._resetSku(),amount.resetBtn()})},_resetSku:function(){var e=search_sku_key();$("#J-last-num").text(e.sku_num),$(".J-amount-bar").attr("max",e.sku_num)},show:function(e){var n=$("#J-panel-cm"),t=n.find(".mask"),a=n.find(".panel-content");this.type=e,n.css("display","block"),a.animate({translateY:"0"},500,"ease-out"),t.animate({opacity:"0.6"},500,"ease-out")},hidden:function(){var e=$("#J-panel-cm"),n=e.find(".mask"),t=e.find(".panel-content");t.animate({translateY:"100%"},500,"ease-in",function(){e.css("display","none")}),n.animate({opacity:0},500,"ease-in")}},CartNum={init:function(){var e=$("#J-cart-num"),n=+e.text();n&&n>0?e.addClass("has-num"):e.removeClass("has-num")},add:function(e){var n=$("#J-cart-num"),t=+n.text();n.text(t+e).addClass("has-num")}};CartNum.init(),initPage()});