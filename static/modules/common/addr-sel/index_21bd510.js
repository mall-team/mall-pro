define("common/addr-sel/index",function(require,exports,module){function AddrSel(e){this.options=e,this.addr=e.addr||{pro:"",proId:0,city:"",cityId:0,region:"",regionId:0},this._init()}var selType,$=require("zepto"),Ajax=require("common/ajax/index"),Alert=require("common/alert/alert"),_tmpl=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+="",$.each(list,function(e,t){__p+='\r\n<option value="'+(null==(__t=t.region_id)?"":__t)+'" '+(null==(__t=id==t.region_id&&id>0?'selected="selected"':"")?"":__t)+" >"+(null==(__t=t.region_name)?"":__t)+"</option>\r\n"}),__p+="\r\n";return __p};AddrSel.prototype={_init:function(){var e=this;e.$proBtn=$(e.options.proBtn),e.$cityBtn=$(e.options.cityBtn),e.$regionBtn=$(e.options.regionBtn),e.$proBtn.on("change",function(t){e._proChange(t)}),e.$cityBtn.on("change",function(t){e._cityChange(t)}),e.$regionBtn.on("change",function(t){e._regionChange(t)}),e._getPro(),this.addr.cityId&&e._getCity(),this.addr.regionId&&e._getRegion(),e._onSelect()},_proChange:function(e){var t=this,n=e.currentTarget,i=n.options[n.selectedIndex];t.addr.pro=i.text,t.addr.proId=i.value,t._getCity(function(){t.$regionBtn[0].selectedIndex=0})},_cityChange:function(e){var t=e.currentTarget,n=t.options[t.selectedIndex];this.addr.city=n.text,this.addr.cityId=n.value,this._getRegion()},_regionChange:function(e){var t=e.currentTarget,n=t.options[t.selectedIndex];this.addr.region=n.text,this.addr.regionId=n.value},_getPro:function(){var e=this;(new Ajax).send({url:"/api/UserAddress/getAllProvince"},function(t){var n=t.data;selType="pro",n.unshift({region_id:"-1",region_name:"选择省份"}),e.$proBtn.html($(_tmpl({list:n,id:e.addr[selType+"Id"]})))})},_getCity:function(e){var t=this;(new Ajax).send({url:"/api/UserAddress/getAllCity",data:{province_id:t.addr.proId}},function(n){var i=n.data;selType="city",i.unshift({region_id:"-1",region_name:"选择市区"}),t.$cityBtn.html($(_tmpl({list:i,id:t.addr[selType+"Id"]}))),e&&e()})},_getRegion:function(){var e=this;(new Ajax).send({url:"/api/UserAddress/getAllDistrict",data:{province_id:e.addr.proId,city_id:e.addr.cityId}},function(t){var n=t.data;selType="region",n.unshift({region_id:"-1",region_name:"选择县区"}),e.$regionBtn.html($(_tmpl({list:n,id:e.addr[selType+"Id"]})))})},_onSelect:function(){var e=this;$(document.body).off("click",".addr-selector li"),$(document.body).on("click",".addr-selector li",function(){var t,n,i=$(this);switch(Alert.hide(),t=i.attr("addrId"),n=i.text(),e._setText(selType,n,t),selType){case"pro":e._setText("city","请选择市区",-1),e._setText("region","请选择县区",-1);break;case"city":e._setText("region","请选择县区",-1)}return!1})},_setText:function(e,t,n){var i=this;i.addr[e]=t,i.addr[e+"Id"]=n,i["$"+e+"Btn"].text(t)},_selPro:function(){var e=this;(new Ajax).send({url:"/User/Center/getAllProvince"},function(t){var n=t.data;selType="pro",n.unshift({region_id:"-1",region_name:"选择省份"}),Alert.show(_tmpl({list:n,id:e.addr[selType+"Id"]}))})},_selCity:function(){var e=this;(new Ajax).send({url:"/User/Center/getAllCity",data:{province_id:e.addr.proId}},function(t){var n=t.data;selType="city",n.unshift({region_id:"-1",region_name:"请选择市区"}),Alert.show(_tmpl({list:n,id:e.addr[selType+"Id"]}))})},_selRegion:function(){var e=this;(new Ajax).send({url:"/User/Center/getAllDistrict",data:{city_id:e.addr.cityId}},function(t){var n=t.data;selType="region",n.unshift({region_id:"-1",region_name:"请选择县区"}),Alert.show(_tmpl({list:n,id:e.addr[selType+"Id"]}))})}},module.exports=AddrSel});