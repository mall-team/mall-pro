define("common/address/index",function(require,exports,module){function show(e){curType="pop",selected=e.selected,getList(function(){})}function initPage(e){curType="page",$pageContent=$(e.container),_rendPage()}function _rendPage(){getList(function(){$pageContent.html(listTmpl({list:listData,maxHei:"auto"})),_initNodes()},!1)}function getList(e,t){(new Ajax).send({url:$("#J-ajaxurl-address-list").val(),type:"get"},function(n){listData=n.data||[],(void 0===t||t)&&(0==listData.length?_openDetail():_openList()),e&&e(n.data)},function(){})}function setDefault(e){var t=$(e.currentTarget),n=t.parents("li").attr("addr-id");(new Ajax).send({url:$("#J-ajaxurl-address-setDefault").val(),data:{id:n}},function(){$radios.removeClass("selected"),t.addClass("selected")})}function edit(e){function t(){curItem=_getAddr(i),_openDetail()}var n=$(e.currentTarget),i=n.parents("li").attr("addr-id");"pop"==curType?Pop.hide(function(){t()}):t()}function add(){function e(){curItem={},_openDetail()}"pop"==curType?Pop.hide(function(){e()}):e()}function save(){var e=$editContainer.find(".J-name").val(),t=$editContainer.find(".J-phone").val(),n=curAddr.addr.proId,i=curAddr.addr.cityId,r=curAddr.addr.regionId,a=$editContainer.find(".J-addr").val();return e?e.length>20?(Bubble.show("用户名长度不得超过20位"),!1):t&&/^1[3-8]\d{9}$/.test(t)?n?i?r?a?a.length>100?(Bubble.show("详细地址长度不得超过100位"),!1):((new Ajax).send({url:$("#J-ajaxurl-address-save").val(),type:"post",data:{id:curItem.id,name:e,phone:t,provinceId:n,cityId:i,districtId:r,detailAddr:a}},function(){Pop.hide(function(){"pop"==curType?getList(null,!1):_rendPage()})}),!1):(Bubble.show("请输入你的详细地址"),!1):(Bubble.show("请选择你所在县区"),!1):(Bubble.show("请选择你所在市区"),!1):(Bubble.show("请选择你所在省份"),!1):(Bubble.show("请输入正确手机号码"),!1):(Bubble.show("请输入用户名"),!1)}function del(){Confirm.show({msg:"您确定删除该地址吗？",yesBack:function(){(new Ajax).send({url:$("#J-ajaxurl-address-del").val(),data:{id:curItem.id}},function(){curItem={},Pop.hide(function(){"pop"==curType?getList():_rendPage()})})}})}function _getAddr(e){for(var t,n=0;n<listData.length;n++)if(t=listData[n],t.id==e)return{id:t.id,province_name:t.provinceName,city_name:t.cityName,region_name:t.districtName,province_id:t.provinceId,city_id:t.cityId,district_id:t.districId,recipient_address:t.detailAddr,is_default:t.isDefault,phone:t.rePhone,realName:t.reName,recipient_name:t.reName,recipient_phone:t.rePhone};return{}}function _openList(){Pop.show({title:"选择收货地址",content:listTmpl({list:listData,maxHei:.7*$(window).height()})}),_initNodes()}function _initNodes(){$container=$(".address-container"),$radios=$container.find(".radio"),$addBtn=$container.find(".btn-add"),$container.on("click",".radio",setDefault),$container.on("click",".addr-info",selCurrent),$container.on("click",".edit",edit),$addBtn.on("click",add)}function selCurrent(){var e=$(this).parent().attr("addr-id");"pop"==curType&&Pop.hide(),selected&&selected(_getAddr(e))}function _openDetail(){Pop.show({title:"收货地址",content:editTmpl({item:curItem})}),$editContainer=$(".address-edit"),$saveBtn=$editContainer.find(".J-save"),$delBtn=$editContainer.find(".J-del"),$saveBtn.on("click",save),$delBtn.on("click",del),curItem.province_name,_initAddrSel()}function _initAddrSel(){var e=$("#J-pro-text"),t=$("#J-city-text"),n=$("#J-region-text"),i=($(".J-addr"),$(".address-edit").find(".J-phone")),r=$(".address-edit").find(".J-name");try{curItem.province_name&&"选择省份"==e.text()&&e.text(curItem.province_name),curItem.city_name&&"选择市区"==t.text()&&t.text(curItem.city_name),curItem.region_name&&"选择县区"==n.text()&&n.text(curItem.region_name),curItem.phone&&!i.val()&&i.val(curItem.phone),curItem.realName&&!r.val()&&r.val(curItem.realName)}catch(a){}curAddr=new AddrSel({proBtn:"#J-pro-text",cityBtn:"#J-city-text",regionBtn:"#J-region-text",addr:{pro:curItem.province_name,proId:curItem.province_id,city:curItem.city_name,cityId:curItem.city_id,region:curItem.region_name,regionId:curItem.district_id}})}var $container,$radios,$addBtn,$editContainer,$saveBtn,$delBtn,selected,$pageContent,$=require("zepto"),Pop=require("common/pop/index"),Ajax=require("common/ajax/index"),Bubble=require("common/bubble/bubble"),AddrSel=require("common/addr-sel/index"),Confirm=require("common/confirm/index"),listTmpl=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="address-container">\r\n	<ul class="address-list" style="max-height: '+(null==(__t=maxHei)?"":__t)+'px">\r\n		',$.each(list,function(e,t){__p+='\r\n		<li class="address-item dib-wrap" addr-id="'+(null==(__t=t.id)?"":__t)+'">\r\n\r\n			<a class="radio ',1==t.isDefault&&(__p+="selected"),__p+=' dib"><i class="icon-radio"></i></a>\r\n			<div class="addr-info dib">\r\n				<p class="user"><span>'+(null==(__t=t.reName)?"":__t)+"，</span><span>"+(null==(__t=t.rePhone)?"":__t)+'</span></p>\r\n				<p class="addr">'+(null==(__t=t.provinceName+t.cityName+t.districtName+t.detailAddr)?"":__t)+'</p>\r\n			</div>\r\n			<a class="edit dib"><i class="icon-edit"></i></a>\r\n		</li>\r\n		'}),__p+='\r\n	</ul>\r\n	<div class="btn-add dib-wrap">\r\n		<span class="dib add-wrap"><i class="icon-add dib"></i></span>\r\n		<label class="dib">新增地址</label>\r\n		<span class="arrow-wrap dib"><i class="icon-arrow dib"></i></span>\r\n	</div>\r\n</div>';return __p},editTmpl=function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="address-edit">\r\n	<ul>\r\n		<li>\r\n			<label>收货人</label>\r\n			<input class="J-name" placeholder="名字" value="'+(null==(__t=item.recipient_name)?"":__t)+'" />\r\n		</li>\r\n		<li>\r\n			<label>联系方式</label>\r\n			<input class="J-phone" type="tel" placeholder="手机或联系电话" value="'+(null==(__t=item.recipient_phone)?"":__t)+'" />\r\n		</li>\r\n		<li>\r\n			<label>选择地区</label>\r\n			<div class="addr-sel">\r\n				<div class="inner">\r\n					<div class="select-wrap">\r\n						<select id="J-pro-text">\r\n							<option>选择省份</option>\r\n						</select>\r\n					</div>\r\n					<div class="select-wrap">\r\n						<select id="J-city-text">\r\n							<option>选择市区</option>\r\n						</select>\r\n					</div>\r\n					<div class="select-wrap">\r\n						<select id="J-region-text">\r\n							<option>选择县区</option>\r\n						</select>\r\n					</div>\r\n				</div>\r\n				<!-- <label id="J-pro-text">'+(null==(__t=item.province_name||"选择省份")?"":__t)+'</label>\r\n				<label id="J-city-text">'+(null==(__t=item.city_name||"选择市区")?"":__t)+'</label>\r\n				<label id="J-region-text">'+(null==(__t=item.region_name||"选择县区")?"":__t)+'</label> -->\r\n			</div>\r\n		</li>\r\n		<li>\r\n			<label>详细地址</label>\r\n			<input class="J-addr" placeholder="街道门牌信息" value="'+(null==(__t=item.recipient_address)?"":__t)+'" />\r\n		</li>\r\n	</ul>\r\n	<div class="btnl-wrap">\r\n		<button type="submit" class="btnl btnl-wx J-save">保存</button>\r\n		',item.recipient_name&&(__p+='\r\n		<a class="btnl btnl-default J-del">删除</a>\r\n		'),__p+="\r\n	</div>\r\n</div>";return __p},listData=null,curAddr={},curItem={},curType="pop";module.exports={show:show,initPage:initPage}});