define("tea/index/index",function(require,exports,module){function init(){addEvent(),initPreTimer(),Panel.init(),initLogin(),CommentSection.init({id:productId,name:$("#J-product-name").val()}),JAjax.init(),JDisabled.init(),new Guide("#J-invite-btn","guide-tea","邀请好友来喝茶吧～<br/><i>怎么邀请？你懂得！</i>")}function addEvent(){$(".J-remind-btn").on("click",remind),$("#J-play-btn").on("click",playVideo),$(".J-btn-buy").on("click",buy)}function buy(e){Panel.show(),e.preventDefault()}function quickBuy(){var e=parseInt($("#J-cm-amount").find(".amount-val").text(),10),n=$("#J-buy-form");$("#J-product-amount").val(e),(new Ajax).send({url:n.attr("action"),type:n.attr("method"),data:n.serialize()},function(){})}function playVideo(){$("#J-video-section").html('<div class="video-wrap">									<iframe class="video_iframe" src="http://v.qq.com/iframe/player.html?vid=s0175pozzea&amp;auto=1" frameborder="0"></iframe>								</div>')}function remind(){(new Ajax).send({url:"/Activity/Tea/subscribeQrCode",data:{pid:Util.getParam("pid"),did:Util.getParam("did"),recommend:Util.getParam("recommend")}},function(result){Alert.show(function(obj){{var __t,__p="";Array.prototype.join}with(obj||{})__p+='<div class="remind-panel">\r\n	<div class="remind-bg"></div>\r\n	<div class="img-erwei">\r\n		<img src="'+(null==(__t=qrcode)?"":__t)+'" />\r\n		<!-- <div class="logo"><img src="http://cdn0.taojinzi.com/static/images/logo_2a50656.png" /></div> -->\r\n	</div>\r\n	<p class="tip">微信扫码，预约抢福利</p>\r\n</div>';return __p}({qrcode:result.url}),!0,"remind-alert")})}function initPreTimer(){var e=$(document.body).hasClass("pre");if(!e)return void start();var n=new Timer("#J-pre-timer",function(){var e=this;return(e.day>0?Timer.addZero(e.day)+"天 ":"")+Timer.addZero(e.hour)+":"+Timer.addZero(e.min)+":"+Timer.addZero(e.sec)});n.start().end(function(){location.reload()})}function start(){rendSendMoney(),setTimeout(start,5e3)}function rendSendMoney(e){(new Ajax).send({url:"/Activity/Tea/alreadySendRedPackage"},function(n){var i=$("#J-send-money");n.redPackage!=i.text()&&(i.html(n.redPackage).addClass("money-ani"),setTimeout(function(){$("#J-send-money").removeClass("money-ani")},1e3)),e&&e()})}function initLogin(){var e=$("#J-is-login").val();0==e&&($("#J-panel-cm").addClass("add-phone"),$yzmBt.on("click",getCode),$phoneOk.on("click",login))}function getCode(){function e(){setTimeout(function(){return i--,$yzmBt.text(i),0>=i?(disabled=!1,void $yzmBt.text("获取验证码").removeClass("disabled")):void e()},1e3)}if(disabled)return!1;var n=$phone.val(),i=60;return(new Ajax).send({url:"/WeChat/Band/sendMsg",data:{phone:n}},function(){disabled=!0,$yzmBt.text(i).addClass("disabled"),e()}),!1}function login(e){var n,i=$phone.val(),t=$code.val(),a=Util.getParam("recommend");return i?/^\d{11}$/.test(i)?t?(n={phone:i,code:t},a&&(n.recommend=a),void(new Ajax).send({url:"/WeChat/Band/bandAccount",type:"post",data:n},function(){Panel.hidden(),$("#J-is-login").val(1),quickBuy(),e.preventDefault()})):(Bubble.show("请输入验证码"),!1):(Bubble.show("请输入正确的手机号码"),!1):(Bubble.show("请输入您的手机号码"),!1)}var $=require("zepto"),Ajax=require("common/ajax/index"),JAjax=require("common/j-ajax/index"),Guide=require("common/guide/guide"),Alert=require("common/alert/alert"),Timer=require("common/timer/timer"),Util=require("common/util/index"),JDisabled=require("common/j-disabled/index"),Amount=require("common/amount/index"),CommentSection=require("common/comment-section/index"),EVENT_TAP="click",amount=new Amount,productId=$("#J-product-id").val(),winHei=$(window).height(),$phoneOk=$("#J-phone-ok2"),$phone=$("#phone2"),$code=$("#code2"),$yzmBt=$("#J-yzm-bt2"),Panel={type:"",init:function(){var e=this,n=$("#J-panel-cm"),i=n.find(".close"),t=n.find(".mask"),a=n.find(".J-ok");n.on("click",function(){return!1}),i.on(EVENT_TAP,function(n){e.hidden(),n.preventDefault()}),t.on(EVENT_TAP,function(n){e.hidden(),n.preventDefault()}),a.on(EVENT_TAP,function(n){e.hidden(),quickBuy(),n.preventDefault()}),e._initSel()},_initSel:function(){var e=this;e._resetSku(),amount.init(),$("#J-cm").delegate("label",EVENT_TAP,function(n){var i=$(n.target);i.siblings("label").removeClass("sel"),i.addClass("sel"),i.siblings("input").val(i.attr("value")),e._resetSku(),amount.resetBtn()})},_resetSku:function(){},show:function(e){var n=$("#J-panel-cm"),i=(n.find(".mask"),n.find(".panel-content"));this.type=e,n.find(".amount-val").text(1),amount.resetBtn(),$("html").attr("style","position: relative; overflow: hidden; height: "+winHei+"px;"),$("body").attr("style","overflow: hidden; height: "+winHei+"px; padding: 0px;"),n.css("display","block"),i.animate({translateY:"0"},300,"ease-out")},hidden:function(){var e=$("#J-panel-cm"),n=(e.find(".mask"),e.find(".panel-content"));n.animate({translateY:"100%"},300,"ease-in",function(){$("html").attr("style",""),$("body").attr("style",""),e.css("display","none")})}};init();var disabled=!1});