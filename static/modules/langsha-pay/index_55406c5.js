define("langsha-pay/index",function(require,exports,module){function init(){new Timer("#J-wait-timer",function(a){var e=parseInt(a/60,10),t=a-60*e;return Timer.addZero(e)+":"+Timer.addZero(t)}).start(),initLastMoney(),addEvent()}function addEvent(){$address.on("click",showAddr),$("#J-pay-other").on("click",function(){Pop.show({content:payTmpl(),hasClose:!1}),$payBtn=$(".J-pay-btn"),$payBtn.off("click",toPay),$payBtn.on("click",toPay)}),$payBtn.on("click",toPay)}function showAddr(){Address.show({selected:function(a){a?($address.find(".user-name").text(a.recipient_name),$address.find(".tel").text(a.recipient_phone),$address.find(".addr-addr").text(a.province_name+a.city_name+a.region_name+a.recipient_address),$address.removeClass("no-address"),$("#J-addr-id").val(a.id)):$("#J-address").addClass("no-address")}})}function toPay(){var a=$(this),e=$("#J-pay-form"),t=a.attr("type");return $payTypeInput.val(t),(new Ajax).send({url:e.attr("action"),data:e.serialize(),type:e.attr("method")},function(a){var e=a.orderId;if(e&&$("#J-order-id").val(e),a.wxPayParams){if(wxLoading)return!1;wxLoading=!0,$(".J-pay-btn.btnl-wx").addClass("loading").text("正在努力加载，请稍候..."),wxPayData=a,wxPay()}},function(a){var e=a.result.orderId;e&&$("#J-order-id").val(e)}),!1}function wxPay(){"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",jsApiCall,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",jsApiCall),document.attachEvent("onWeixinJSBridgeReady",jsApiCall)):jsApiCall()}function jsApiCall(){WeixinJSBridge.invoke("getBrandWCPayRequest",JSON.parse(wxPayData.wxPayParams),function(a){wxLoading=!1,$(".J-pay-btn.btnl-wx").removeClass("loading").text("微信安全支付"),WeixinJSBridge.log(a.err_msg),"get_brand_wcpay_request:ok"==a.err_msg?setTimeout(function(){location.href=wxPayData.wxPaySucUrl},500):"get_brand_wcpay_request:cancel"!=a.err_msg&&alert(a.err_code+" "+a.err_desc)})}function initLastMoney(){$minusContent.find(".price b").text(Math.min(lastVal,totalVal)),$minusContent.css("display","none"),$lastPay.text(totalVal),$needPayInput.val(totalVal),0==lastVal?$moneyLast.addClass("disabled"):$moneyLast.addClass("usable").on("click",function(){var a=$(this),e=(+totalVal-lastVal).toFixed(2);0>e&&(e=0),a.hasClass("selected")?(a.removeClass("selected"),$useLastInput.val(0),$minusContent.css("display","none"),$lastPay.text(totalVal),$needPayInput.val(totalVal),$("footer").removeClass("use-yue")):(a.addClass("selected"),$useLastInput.val(1),$needPayInput.val(e),lastVal>=totalVal?$("footer").addClass("use-yue"):($minusContent.css("display","inline"),$lastPay.text(e),$lastPayLabel.text("还需支付"),$("footer").removeClass("use-yue")))})}var wxPayData,$=require("zepto"),Pop=require("common/pop/index"),Address=require("common/address/index"),Ajax=require("common/ajax/index"),Timer=require("common/timer/timer"),payTmpl=function(obj){{var __p="";Array.prototype.join}with(obj||{})__p+='<div class="pay-types">\r\n	<button class="J-pay-btn btnl btnl-default" type="1">支付宝</button>\r\n	<!-- <button class="J-pay-btn btnl btnl-default" type="3">银联支付</button> -->\r\n</div>';return __p},totalVal=(+$("#J-total-val").val()+ +$("#J-trans-val").val()).toFixed(2),lastVal=+$("#J-last-val").val(),$moneyLast=$("#J-money-last"),$minusContent=$("#J-minus-content"),$lastPay=$("#J-last-pay"),$lastPayLabel=$("#J-last-text"),$useLastInput=$("#J-use-last"),$payTypeInput=$("#J-pay-type"),$needPayInput=$("#J-need-pay"),$payBtn=$(".J-pay-btn"),$address=$("#J-address"),wxLoading=!1;init()});